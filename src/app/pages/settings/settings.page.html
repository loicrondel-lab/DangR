<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Paramètres</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Paramètres</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="container">
    <!-- Notifications -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="notifications-outline"></ion-icon>
          Notifications
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-list>
          <!-- Activer/Désactiver les notifications -->
          <ion-item>
            <ion-label>
              <h2>Notifications activées</h2>
              <p>Recevoir des alertes pour les dangers à proximité</p>
            </ion-label>
            <ion-toggle
              [(ngModel)]="settings.enabled"
              (ionChange)="onSettingsChange()">
            </ion-toggle>
          </ion-item>

          <!-- Distance maximale -->
          <ion-item>
            <ion-label position="stacked">
              Distance d'alerte: {{ getDistanceLabel(settings.maxDistance) }}
            </ion-label>
            <ion-range
              [(ngModel)]="settings.maxDistance"
              min="1000"
              max="10000"
              step="500"
              pin="true"
              color="primary"
              [disabled]="!settings.enabled"
              (ionChange)="onSettingsChange()">
            </ion-range>
            <ion-note>Distance maximale pour recevoir des alertes</ion-note>
          </ion-item>

          <!-- Sévérité minimale -->
          <ion-item>
            <ion-label position="stacked">Sévérité minimale</ion-label>
            <ion-range
              [value]="getSeverityIndex(settings.minSeverity)"
              min="0"
              max="3"
              step="1"
              snaps="true"
              pin="true"
              color="primary"
              [disabled]="!settings.enabled"
              (ionChange)="onSeverityChange($event)">
            </ion-range>
            <ion-note>Niveau minimum de danger pour recevoir une alerte</ion-note>
          </ion-item>

          <!-- Son -->
          <ion-item>
            <ion-label>
              <h3>Son</h3>
              <p>Jouer un son lors des notifications</p>
            </ion-label>
            <ion-toggle
              [(ngModel)]="settings.soundEnabled"
              [disabled]="!settings.enabled"
              (ionChange)="onSettingsChange()">
            </ion-toggle>
          </ion-item>

          <!-- Vibration -->
          <ion-item>
            <ion-label>
              <h3>Vibration</h3>
              <p>Faire vibrer l'appareil lors des notifications</p>
            </ion-label>
            <ion-toggle
              [(ngModel)]="settings.vibrationEnabled"
              [disabled]="!settings.enabled"
              (ionChange)="onSettingsChange()">
            </ion-toggle>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Types de dangers -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Types de dangers</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-list>
          <ion-list-header>
            <ion-label>Recevoir des alertes pour :</ion-label>
          </ion-list-header>
          
          <ion-item *ngFor="let type of dangerTypes">
            <ion-checkbox
              [checked]="isDangerTypeEnabled(type)"
              [disabled]="!settings.enabled"
              (ionChange)="onDangerTypeToggle(type, $event)">
            </ion-checkbox>
            <ion-label class="ion-margin-start">
              {{ dangerTypeLabels[type] }}
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Permissions et tests -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="location-outline"></ion-icon>
          Permissions et tests
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-list>
          <ion-item button (click)="requestLocationPermission()">
            <ion-icon name="location-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Permission de géolocalisation</h3>
              <p>Autoriser l'accès à votre position</p>
            </ion-label>
          </ion-item>

          <ion-item button (click)="testNotification()">
            <ion-icon name="notifications-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Tester les notifications</h3>
              <p>Envoyer une notification de test</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Statistiques -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="stats-chart-outline"></ion-icon>
          Statistiques
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">{{ stats.total || 0 }}</div>
            <div class="stat-label">Dangers signalés</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value">{{ stats.byStatus?.active || 0 }}</div>
            <div class="stat-label">Actifs</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value">{{ stats.byStatus?.inactive || 0 }}</div>
            <div class="stat-label">Résolus</div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Actions -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Actions</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-button 
          expand="block" 
          fill="outline" 
          color="danger"
          (click)="clearAllData()">
          <ion-icon name="trash-outline" slot="start"></ion-icon>
          Effacer toutes les données
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Informations -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="information-circle-outline"></ion-icon>
          À propos
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <p>
          <strong>Danger Alert</strong> v1.0.0
        </p>
        <p>
          Application de signalement de dangers à proximité.
          Restez informé des dangers sur votre route et aidez les autres utilisateurs 
          en signalant les incidents que vous rencontrez.
        </p>
        <ion-note>
          Vos signalements sont anonymes et votre vie privée est respectée.
        </ion-note>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>